<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>日迹</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <a href="#main" class="skip-link">跳到主内容</a>
  <div class="app">
    <header class="topbar">
      <div class="topbar-inner">
        <h1 class="logo"><img src="favicon.svg" alt="" class="logo-icon" width="28" height="28" />日迹</h1>
        <div class="topbar-actions" id="topbarActions">
          <span class="sync-status-text visually-hidden" id="syncStatusText" aria-live="polite"></span>
          <button type="button" class="btn btn-ghost btn-icon-only sync-status-btn" id="syncStatusBtn" title="云同步状态" aria-label="云同步状态"><span class="sync-status-icon" id="syncStatusIcon" aria-hidden="true"></span></button>
          <button type="button" class="btn btn-ghost btn-icon-only btn-theme" id="btnTheme" title="切换浅色/深色主题" aria-label="切换为深色主题" aria-pressed="false"><span class="theme-btn-icon" aria-hidden="true">☀️</span></button>
          <button type="button" class="btn btn-primary btn-new desktop-only" id="btnNew" title="新建习惯（N）"><span class="btn-icon">+</span> 新建习惯</button>
          <div class="topbar-settings-wrap desktop-only">
            <button type="button" class="btn btn-ghost" id="btnSettings" title="设置" aria-haspopup="true" aria-expanded="false">设置</button>
            <div class="settings-dropdown hidden" id="settingsDropdown">
              <button type="button" class="export-option" id="btnSettingsNew">新建习惯</button>
              <button type="button" class="export-option" id="btnSettingsExportJson">导出 JSON</button>
              <button type="button" class="export-option" id="btnSettingsExportCsv">导出 CSV</button>
              <button type="button" class="export-option" id="btnSettingsImport">导入数据</button>
              <button type="button" class="export-option" id="btnSettingsSync">云同步</button>
              <button type="button" class="export-option" id="btnSettingsShare">分享</button>
            </div>
          </div>
          <input type="file" class="import-file-input hidden" id="importFileInput" accept=".json,.csv,application/json,text/csv" />
        </div>
      </div>
    </header>
    <div class="sync-panel hidden" id="syncPanel" role="dialog" aria-modal="true" aria-labelledby="syncTitle" aria-describedby="syncInstructions">
      <div class="sync-panel-inner">
        <div class="sync-header">
          <h3 class="sync-title" id="syncTitle">云同步设置</h3>
          <button type="button" class="sync-close" id="syncClose" aria-label="关闭（Esc）">×</button>
        </div>
        <div class="sync-status-bar hidden" id="syncStatusBar" aria-live="polite">
          <span class="sync-status-bar-icon" aria-hidden="true">✓</span>
          <span class="sync-status-bar-text" id="syncStatusBarText"></span>
        </div>
        <div class="sync-instructions" id="syncInstructions">
          <p class="sync-instructions-title">使用说明：</p>
          <ol class="sync-instructions-list">
            <li>前往 <a href="https://github.com/settings/tokens/new?scopes=gist&description=habits-tracker" target="_blank" rel="noopener">GitHub Settings → Tokens</a> 创建 Token</li>
            <li>勾选 gist 权限，其他不需要</li>
            <li>将生成的 Token 粘贴到下方输入框</li>
            <li>Token 仅保存在当前浏览器本地，不会发送到其他地方</li>
          </ol>
        </div>
        <div class="sync-form">
          <label class="sync-field">
            <span class="sync-field-label">GitHub Personal Access Token</span>
            <span class="sync-input-wrap">
              <input type="password" class="sync-input" id="syncToken" placeholder="ghp_xxxx..." autocomplete="off" />
              <button type="button" class="sync-input-eye" id="syncTokenEye" aria-label="显示/隐藏 Token" title="显示/隐藏">👁</button>
            </span>
          </label>
          <label class="sync-field">
            <span class="sync-field-label">Gist ID <span class="sync-field-optional">（可选，留空自动创建）</span></span>
            <input type="text" class="sync-input" id="syncGistIdBind" placeholder="留空则首次推送时自动创建" autocomplete="off" />
            <span class="sync-field-hint">如需在新设备恢复数据，填入之前的 Gist ID</span>
          </label>
        </div>
        <div class="sync-footer">
          <div class="sync-actions-row sync-actions-row-main">
            <div class="sync-actions-group">
              <button type="button" class="btn btn-outline sync-btn" id="btnSyncPush">推送到云端</button>
              <button type="button" class="btn btn-outline sync-btn" id="btnSyncPull">从云端拉取</button>
            </div>
            <button type="button" class="btn btn-primary sync-btn" id="btnSyncSaveSettings">保存设置</button>
          </div>
        </div>
        <p class="sync-status" id="syncStatus"></p>
      </div>
    </div>
    <div class="share-panel hidden" id="sharePanel" role="dialog" aria-modal="true" aria-labelledby="shareTitle" aria-describedby="shareInstructions">
      <div class="share-panel-inner">
        <div class="share-header">
          <h3 class="share-title" id="shareTitle">分享</h3>
          <button type="button" class="share-close" id="shareClose" aria-label="关闭（Esc）">×</button>
        </div>
        <div class="share-instructions" id="shareInstructions">
          <p class="share-instructions-title">选择时间范围和习惯，可导出只读分享页或生成分享图。</p>
        </div>
        <div class="share-form">
          <label class="share-field">
            <span class="share-field-label">时间范围</span>
            <select class="share-select" id="shareTimeRange">
              <option value="year">最近一年</option>
              <option value="90days">最近 90 天</option>
              <option value="thisYear" selected>今年</option>
              <option value="custom">自定义</option>
            </select>
          </label>
          <div class="share-custom-dates hidden" id="shareCustomDates">
            <label class="share-field">
              <span class="share-field-label">开始日期</span>
              <input type="date" class="share-input" id="shareStartDate" />
            </label>
            <label class="share-field">
              <span class="share-field-label">结束日期</span>
              <input type="date" class="share-input" id="shareEndDate" />
            </label>
          </div>
          <label class="share-field">
            <span class="share-field-label">生成分享图时包含的习惯</span>
            <div class="share-interests-list" id="shareInterestsList"></div>
          </label>
        </div>
        <div class="share-footer">
          <div class="share-actions-row share-actions-row-main">
            <div class="share-actions-group">
              <button type="button" class="btn btn-outline share-btn" id="btnExportReadonly">导出只读分享页</button>
              <button type="button" class="btn btn-primary share-btn" id="btnGenerateImage">生成分享图</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-wrap">
    <main class="main" id="main" tabindex="-1" data-tab="interests">
      <div class="main-loading-skeleton hidden" id="mainLoadingSkeleton" aria-hidden="true">
        <div class="skeleton-card">
          <div class="skeleton-header"></div>
          <div class="skeleton-stats"></div>
          <div class="skeleton-grid"></div>
        </div>
      </div>
      <div class="main-placeholder" id="mainPlaceholder">
        <span class="placeholder-icon" aria-hidden="true">
          <svg width="64" height="48" viewBox="0 0 64 48" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
            <rect x="2" y="2" width="10" height="8" rx="2" fill="currentColor" opacity="0.2"/>
            <rect x="14" y="2" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="26" y="2" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="38" y="2" width="10" height="8" rx="2" fill="currentColor" opacity="0.2"/>
            <rect x="50" y="2" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="2" y="12" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="14" y="12" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="26" y="12" width="10" height="8" rx="2" fill="currentColor" opacity="0.7"/>
            <rect x="38" y="12" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="50" y="12" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="2" y="22" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="14" y="22" width="10" height="8" rx="2" fill="currentColor" opacity="0.7"/>
            <rect x="26" y="22" width="10" height="8" rx="2" fill="currentColor" opacity="0.9"/>
            <rect x="38" y="22" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="50" y="22" width="10" height="8" rx="2" fill="currentColor" opacity="0.2"/>
            <rect x="2" y="32" width="10" height="8" rx="2" fill="currentColor" opacity="0.2"/>
            <rect x="14" y="32" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="26" y="32" width="10" height="8" rx="2" fill="currentColor" opacity="0.5"/>
            <rect x="38" y="32" width="10" height="8" rx="2" fill="currentColor" opacity="0.35"/>
            <rect x="50" y="32" width="10" height="8" rx="2" fill="currentColor" opacity="0.2"/>
          </svg>
        </span>
        <p data-placeholder-text>加载中…</p>
        <p class="placeholder-sub" data-placeholder-sub>还没有习惯，点击右上角「新建习惯」开始</p>
      </div>
      <div class="quick-record-bar hidden" id="quickRecordBar" role="toolbar" aria-label="今日快捷记录"></div>
      <div class="tag-filter-bar hidden" id="tagFilterBar">
        <span class="tag-filter-label">标签：</span>
        <button type="button" class="tag-filter-pill active" data-tag="">全部</button>
        <div class="tag-filter-pills" id="tagFilterPills"></div>
      </div>
      <div class="heatmap-cards" id="heatmapCards" role="list"></div>
      <div class="first-use-hint hidden" id="firstUseHint">
        <span class="first-use-hint-arrow">↓</span>
        <p>点击任意格子开始第一次记录</p>
      </div>
    </main>
    <div class="settings-view hidden" id="settingsView" data-tab="settings" aria-label="设置">
      <div class="settings-view-inner">
        <h2 class="settings-view-title">设置</h2>
        <div class="settings-group">
          <h3 class="settings-group-title">外观</h3>
          <div class="settings-list">
            <button type="button" class="settings-item" id="settingsBtnTheme"><span class="settings-item-icon" aria-hidden="true">🌓</span> 主题切换</button>
          </div>
        </div>
        <div class="settings-group">
          <h3 class="settings-group-title">数据</h3>
          <div class="settings-list">
            <button type="button" class="settings-item" id="settingsBtnExportJson">导出 JSON</button>
            <button type="button" class="settings-item" id="settingsBtnExportCsv">导出 CSV</button>
            <button type="button" class="settings-item" id="settingsBtnImport">导入数据</button>
          </div>
        </div>
        <div class="settings-group">
          <h3 class="settings-group-title">同步与分享</h3>
          <div class="settings-list">
            <button type="button" class="settings-item" id="settingsBtnSync">云同步</button>
            <button type="button" class="settings-item" id="settingsBtnShare">分享</button>
          </div>
        </div>
      </div>
    </div>
    </div>
    <nav class="bottom-tabs hidden" id="bottomTabs" aria-label="主导航">
      <button type="button" class="bottom-tab active" id="tabInterests" data-tab="interests" aria-current="page">习惯</button>
      <button type="button" class="bottom-tab" id="tabSettings" data-tab="settings">设置</button>
    </nav>
  </div>
  <div class="confirm-modal hidden" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle" aria-describedby="confirmModalMessage">
    <div class="confirm-modal-backdrop" id="confirmModalBackdrop"></div>
    <div class="confirm-modal-inner">
      <h2 class="confirm-modal-title" id="confirmModalTitle">确认</h2>
      <p class="confirm-modal-message" id="confirmModalMessage">确定要删除这个习惯记录吗？</p>
      <div class="confirm-modal-actions">
        <button type="button" class="btn btn-ghost" id="confirmModalCancel">取消</button>
        <button type="button" class="btn btn-danger" id="confirmModalConfirm">确定</button>
      </div>
    </div>
  </div>
  <script>
    (function () {
      var s = document.createElement("script");
      s.src = "app.js?t=" + Date.now();
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
